<!doctype html><html lang="zh"><head><script>(function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer'
            ? '&l=' + l
            : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f
          .parentNode
          .insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-N5BVZ6D');</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:300,400,500,700&display=swap&subset=chinese-simplified" rel="stylesheet"><link rel="icon" type="image/icon" href="/assets/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"><title>在 WSL 上配置 Vim 编辑器</title><script data-ad-client="ca-pub-8663822397755998" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body><div class="container"><nav class="nav"><div class="site-nav"><a href="/" class="site-nav__brand"><svg class="site-nav__logo"><use xlink:href="/assets/img/logo.svg#icon_logo"></use></svg> <span class="mobile-site-nav__info">byodian's blog</span></a><div class="navbar__menu"><ul class="nav__list"><li class="nav__item"><a href="/" class="nav__link">首页</a></li><li class="nav__item"><a href="/posts/" class="nav__link">博客</a></li><li class="nav__item"><a href="/projects/" class="nav__link">项目</a></li><li class="nav__item"><a class="nav__link" href="https://resource.netlify.com/">导航</a></li><li class="nav__item dropdown-container"><button class="btn nav__button">更多 <svg width="10" height="7" viewbox="0 0 26 14" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-left: 10px"><line x1="0.353553" y1="0.646447" x2="13.3536" y2="13.6464" stroke="black"/><line x1="12.6464" y1="13.6464" x2="25.6464" y2="0.646446" stroke="black"/></svg></button><div class="dropdown"><ul class="dropdown__list"><li class="dropdown__item"><a href="/tags/">标签</a></li><li class="dropdown__item"><a href="/about/">关于</a></li><li class="dropdown__item"><a href="/feed.xml">RSS</a></li></ul></div></li></ul></div></div></nav><main class="content"><div class="post"><div class="post-article"><section class="post__info"><h1 class="post__title">在 WSL 上配置 Vim 编辑器</h1><time class="post__date" datetime="2020-06-25T04:31:16.141Z">June 25, 2020</time> <a href="/tags/linux/" class="stress stress--tag">linux</a></section><p>本文将教你如何在 Windows 的子系统 Linux （英文名 Windows Subsystem for Linux ，简称 WSL）上使用 Vim 编辑器。</p><p>参考 [配置 Windows 终端 &amp; WSL 开发环境](ht tps://byodiandev.com/how-to-setting-up-wsl/) 这篇文章配置 WSL 开发环境。</p><p>近期 WSL 已经从 WSL1 升级到 WSL2，WSL 2 提高了文件系统性能并增加完全的系统调用兼容性。在同一网络环境下与 WSL1 相比，WSL2 在执行 <code>git clone</code>、<code>apt install</code> 等命令时有着更快的速度。</p><p>接下来进入主题开始配置 Vim。</p><h2>基础设置</h2><p>这一部分是 Vim 基础设置，像显示行号、语法高亮显示等等。</p><p>首先在 WSL 主目录（<code>~</code>）中添加配置文件 <code>.vimrc</code> ，将下面的内容添加进去。</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token builtin class-name">set</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span>utf-8</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> nocompatible</span><br><span class="highlight-line">syntax on</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> noerrorbells</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> nu</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> <span class="token assign-left variable">tabstop</span><span class="token operator">=</span><span class="token number">4</span></span><br><span class="highlight-line"><span class="token builtin class-name">set</span> <span class="token assign-left variable">shiftwidth</span><span class="token operator">=</span><span class="token number">4</span></span><br><span class="highlight-line"><span class="token builtin class-name">set</span> <span class="token assign-left variable">softtabstop</span><span class="token operator">=</span><span class="token number">4</span></span><br><span class="highlight-line"><span class="token builtin class-name">set</span> expandtab</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> smartindent</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> nowrap</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> smartcase</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> noswapfile</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> nobackup</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> <span class="token assign-left variable">undodir</span><span class="token operator">=</span>~/.vim/undodir</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> undofile</span><br><span class="highlight-line"><span class="token builtin class-name">set</span> incsearch</span></code></pre><h2>进阶设置 vim-plug</h2><p>这部分会使用插件强化 Vim 编辑器。推荐使用 Vim 插件管理器管理插件，目前有几个插件管理器可供选择，比如 <a href="https://github.com/junegunn/vim-plug">vim-plug</a>、<a href="https://github.com/VundleVim/Vundle.vim">Vundle.vim</a> 等等。它们都提供了诸如安装、卸载和更新的功能，方便我们管理插件。</p><p>我比较推荐 <a href="https://github.com/junegunn/vim-plug">vim-plug</a> 插件管理器，它设置简单，容易使用，支持超速的并行安装和更新。首先需要安装 vim-plug，参考 <a href="https://github.com/junegunn/vim-plug#installation">官方安装步骤</a>。</p><h3>安装</h3><p>下载 <a href="https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim">plug.vim</a> 文件，并把它放到 <strong>“autoload”</strong> 目录。</p><p>终端运行以下命令，下载 <strong>plug.vim</strong> 文件，并且将会保存在 <code>~/.vim/autoload/</code> 路径下。</p><h4>linux</h4><pre class="language-shell"><code class="language-shell"><span class="highlight-line"><span class="token function">curl</span> -fLo ~/.vim/autoload/plug.vim --create-dirs <span class="token punctuation">\</span></span><br><span class="highlight-line">    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span></code></pre><h4>Windows (PowerShell)</h4><pre class="language-bash"><code class="language-bash"><span class="highlight-line">md ~<span class="token punctuation">\</span>.vim<span class="token punctuation">\</span>autoload</span><br><span class="highlight-line"><span class="token variable">$uri</span> <span class="token operator">=</span> <span class="token string">'https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'</span></span><br><span class="highlight-line"><span class="token punctuation">(</span>New-Object Net.WebClient<span class="token punctuation">)</span>.DownloadFile<span class="token punctuation">(</span></span><br><span class="highlight-line">  <span class="token variable">$uri</span>,</span><br><span class="highlight-line">  <span class="token variable">$ExecutionContext</span>.SessionState.Path.GetUnresolvedProviderPathFromPSPath<span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token string">"~\.vim<span class="token entity" title="\a">\a</span>utoload\plug.vim"</span></span><br><span class="highlight-line">  <span class="token punctuation">)</span></span><br><span class="highlight-line"><span class="token punctuation">)</span></span></code></pre><h3>用法</h3><p>将以下内容添加到 <code>~/.vimrc</code> 文件中。</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">call plug<span class="token comment">#begin('~/.vim/plugged')</span></span><br><span class="highlight-line">// 插件应该放在这个位置</span><br><span class="highlight-line">Plug <span class="token string">'vim-utils/vim-man'</span></span><br><span class="highlight-line">Plug <span class="token string">'gruvbox-community/gruvbox'</span></span><br><span class="highlight-line">call plug<span class="token comment">#end()</span></span></code></pre><h3>命令</h3><p>vim 普通模式下运行 vim-plug 命令。</p><ul><li><code>PlugInstall</code> 安装插件</li><li><code>PlugUpdate</code> 更新或安装插件</li><li><code>PlugUpgrade</code> 更新 vim-plug</li><li><code>PlugClean</code> 移除不在列表中的插件</li><li><code>PlugStatus</code> 查看插件状态</li></ul><h3>注意</h3><ol><li>vim 插件安装路径 <code>~/.vim/plugged</code></li><li><code>vim-plug</code> 配置文件 <code>plug.vim</code> 的路径为 <code>~/.vim/autoload</code></li></ol><h2>插件推荐</h2><h3>YouCompleteMe （YCM）</h3><p><a href="https://github.com/ycm-core/YouCompleteMe">YouCompleteMe</a> Github 主页。</p><h4>Linux 64-bit</h4><p>Linux <a href="https://github.com/ycm-core/YouCompleteMe#linux-64-bit">安装步骤</a></p><ul><li><p>添加插件信息到 <code>~/.vimrc</code> 文件中。</p><pre class="language-shell"><code class="language-shell"><span class="highlight-line">call plug<span class="token comment">#begin('~/.vim/plugged')</span></span><br><span class="highlight-line">// YouCompleteMe 插件放在这个位置</span><br><span class="highlight-line">Plug <span class="token string">'ycm-core/YouCompleteMe'</span></span><br><span class="highlight-line">call plug<span class="token comment">#end()</span></span></code></pre></li><li><p>在 vim 编辑器中运行下面的命令，安装插件 YCM。</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line">:PlugInstall</span></code></pre></li><li><p>安装 cmake、vim、python3-dev</p><pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> build-essential cmake <span class="token function">vim</span> python3-dev</span></code></pre></li><li><p>安装 mono-complete、go、node 和 npm</p></li><li><p>编译 YCM</p><pre class="language-shell"><code class="language-shell"><span class="highlight-line"><span class="token builtin class-name">cd</span> ~/.vim/plugged/YouCompleteMe</span><br><span class="highlight-line">python3 install.py --all</span></code></pre></li></ul><p><code>-all</code> 表示安装所有的语言特性。其他可利用的参数还有：</p><ul><li><p><code>--clangd-completer</code>，C-family 语言支持</p></li><li><p><code>--cs-completer</code>，c# 语言支持，需要先安装 <a href="https://www.mono-project.com/download/stable/#download-lin">Mono</a> 。</p></li><li><p><code>--go-completer</code>，GO 语言支持，需要先安装 <a href="https://golang.org/doc/install">Go</a> 。</p></li><li><p><code>--ts-completer</code>，Javascript 和 TypeScript 语言支持，需要先安装 <a href="https://docs.npmjs.com/getting-started/installing-node#1-install-nodejs--npm">Node.js &amp; npm</a> 。</p></li><li><p><code>--rust-completer</code>，Rust 语言支持。</p></li><li><p><code>--java-completer</code>，Java 语言支持，需要先安装 <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK8 (version 8 required)</a> 。</p></li></ul><h4>macOS</h4><p>macOS <a href="https://github.com/ycm-core/YouCompleteMe#installation">安装步骤</a></p><h3>gruvbox</h3><p>vim 主题</p><h3>vim-fugitive</h3><p>vim 编辑器中执行 git 命令</p><h3>nerdtree</h3><h3>vim-airline</h3><h3>undotree</h3><h3>vim-man</h3><h3>vim-polyglot</h3><h2>常见问题</h2><h3>WSL vim 编辑器使用 Windows 系统的剪贴板</h3><ol><li><p>安装 <a href="https://sourceforge.net/projects/vcxsrv/">VcXsrV</a> （安装后先不要启动）</p></li><li><p>开始菜单中启动 <strong>XLaunch</strong></p></li><li><p>使用默认选项，一路点击 <strong>下一步</strong> ，确保选择 <strong>Clipboard</strong> 选项</p></li><li><p>安装结束 <strong>XLaunch</strong> 时，保存配置文件 <strong>config.xlaunch</strong>，并且启动。</p></li><li><p>在 WSL 系统的 <code>~/.bashrc</code> 文件中添加下面的代码，并且在终端运行 <code>source ~/.bashrc</code>。</p><pre class="language-shell"><code class="language-shell"><span class="highlight-line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">DISPLAY</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> nameserver /etc/resolv.conf <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/nameserver //'</span><span class="token variable">`</span></span>:0"</span></span></code></pre></li><li><p>Running the following command, it is possible to see that the $DISPLAY environment variable now has the Windows Host’s IP set:</p><pre class="language-shell"><code class="language-shell"><span class="highlight-line"><span class="token builtin class-name">echo</span> <span class="token environment constant">$DISPLAY</span></span></code></pre></li><li><p>确保 Vim 有剪贴板的支持。终端运行 <code>vim --version |grep clipboard</code> ，结果应该是 <strong>+clipboard</strong> ，如而不是 <strong>-clipboard</strong>。或者在 vim 编辑器中运行命令 <code>:echo has(&quot;clipboard&quot;)</code> ，若结果是 <code>0</code> ，表示 vim 没有剪贴板的支持。</p></li><li><p>如果没有剪贴版支持，你需要安装剪贴板支持，在终端运行 <code>sudo apt install vim-gtk</code></p></li><li><p>现在你就可以使用 <code>*p</code>、<code>*y</code> 命令进入 Windows 系统的剪贴板了。或者通过添加 <code>set clipboard=unnamed</code> 到 <strong>~/.vimrc</strong> 文件中，设置为默认。</p></li></ol><h2>参考</h2><ul><li><a href="https://vitux.com/how-to-install-cmake-on-ubuntu-18-04/">How to Install CMake on Ubuntu 18.04 LTS</a></li><li><a href="https://www.jianshu.com/p/3703b1e0925e">linux下安装cmake</a></li><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/">适用于 Linux 的 Windows 子系统文档</a> 了解更多 WSL2 特点。</li><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10#update-to-wsl-2">适用于 Linux 的 Windows 子系统安装指南 (Windows 10)</a> 更新 WSL1 到 WSL2。</li><li><a href="https://techcommunity.microsoft.com/t5/windows-dev-appconsult/running-wsl-gui-apps-on-windows-10/ba-p/1493242">Running WSL GUI Apps on Windows 10</a></li></ul></div></div></main><div id="disqus_thread"></div><script>/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    /* var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
}; */
    (function () { // DON'T EDIT BELOW THIS LINE
      var d = document,
        s = d.createElement('script');
      s.src = 'https://byodian.disqus.com/embed.js';
      s.setAttribute('data-timestamp', + new Date());
      (d.head || d.body).appendChild(s);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script src="/js/script.js"></script><script src="https://kit.fontawesome.com/d101a7035d.js" crossorigin="anonymous"></script></body></html>